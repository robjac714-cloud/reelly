<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Reelly Property Search â€” Cards + Images + Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet (Ø§Ù„Ø®Ø±ÙŠØ·Ø©) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <style>
    :root{
      --bg:#0b1020; --card:#11162a; --muted:#8b93a7; --text:#eaf1ff;
      --accent:#4f86ff; --chip:#1b223d;
    }
    *{box-sizing:border-box}
    body{ font-family:system-ui,Tahoma,Arial; margin:24px; background:var(--bg); color:var(--text) }
    a{ color:var(--accent) }
    h1{ margin:0 0 10px }
    .wrap{ max-width:1200px; margin:0 auto }
    form{ background:var(--card); border:1px solid #1d2442; border-radius:16px; padding:16px;
          display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px 16px }
    label{ font-size:12px; color:var(--muted); display:block; margin-bottom:6px }
    input,select{ width:100%; padding:10px 12px; border:1px solid #273057; background:#0f1530; color:var(--text); border-radius:10px }
    input::placeholder{ color:#66709a }
    .full{ grid-column:1 / -1 }
    .actions{ display:flex; gap:10px; margin-top:2px; flex-wrap:wrap }
    button{ padding:10px 16px; border:0; border-radius:10px; cursor:pointer; background:var(--accent); color:#fff; font-weight:600 }
    .ghost{ background:#1d2442; color:#cfe1ff }
    .results{ margin-top:22px }
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:18px }
    .card{ border:1px solid #1d2442; background:linear-gradient(180deg,#111936,#0f1530); border-radius:16px; overflow:hidden; box-shadow:0 4px 18px rgba(0,0,0,.25); display:flex; flex-direction:column }
    .thumb{ width:100%; aspect-ratio:16/10; object-fit:cover; background:#0c1127 }
    .card-body{ padding:12px 14px }
    .title{ font-weight:700; margin:0 0 6px; line-height:1.25 }
    .meta{ font-size:13px; color:var(--muted); display:flex; flex-wrap:wrap; gap:8px }
    .chip{ background:var(--chip); border:1px solid #273057; padding:4px 8px; border-radius:999px }
    .cta{ display:flex; gap:8px; margin-top:12px }
    .btn{ flex:1; display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 12px; border-radius:10px; border:1px solid #29335e; background:#162049; color:#dfe7ff; text-decoration:none }
    .btn[disabled]{ opacity:.5; cursor:not-allowed }
    .muted{ color:var(--muted); font-size:12px }
    .panel{ border:1px solid #1d2442; background:#0f1530; border-radius:12px; padding:10px }
    pre{ background:#0a0f25; color:#d8e4ff; padding:12px; border-radius:10px; overflow:auto }
    .head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px }
    .toggle{ background:#1d2442; border:1px solid #273057; color:#dfe7ff; padding:8px 12px; border-radius:10px; cursor:pointer }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:50 }
    .modal{ width:min(1100px,95vw); height:min(75vh,800px); background:#0f1530; border:1px solid #1d2442; border-radius:16px; overflow:hidden; display:flex; flex-direction:column }
    .modal-header{ display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-bottom:1px solid #1d2442 }
    #map{ flex:1; width:100% }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <h1>Ø¨Ø­Ø« Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª (Reelly)</h1>
      <button id="toggleRaw" class="toggle">Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ JSON</button>
    </div>
    <p class="muted">Ø§Ù…Ù„Ø£ Ù…Ø§ ÙŠÙ„Ø²Ù… ÙÙ‚Ø·. Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§ÙƒØªØ¨Ù‡Ø§ Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„ <code>1,2,3</code>.</p>

    <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
    <form id="searchForm">
      <div><label>page</label><input type="number" name="page" min="1" placeholder="1"></div>
      <div><label>per_page (Ø­ØªÙ‰ 50)</label><input type="number" name="per_page" min="1" max="50" placeholder="12"></div>

      <div class="full"><label>search_query</label><input type="text" name="search_query" placeholder="Dubai / Marina / Emaar"></div>
      <div class="full"><label>project_ids</label><input type="text" name="project_ids" placeholder="12,45,99"></div>

      <div><label>country</label><input type="text" name="country" placeholder="UAE"></div>
      <div><label>region</label><input type="text" name="region" placeholder="Dubai"></div>
      <div><label>areas</label><input type="text" name="areas" placeholder="101,202"></div>

      <div><label>status</label><input type="text" name="status" placeholder="active,upcoming"></div>
      <div><label>sale_status</label><input type="text" name="sale_status" placeholder="available,sold_out"></div>
      <div><label>unit_types</label><input type="text" name="unit_types" placeholder="apartment,villa,studio"></div>
      <div><label>unit_bedrooms</label><input type="text" name="unit_bedrooms" placeholder="studio,1,2,3"></div>

      <div><label>developer</label><input type="text" name="developer" placeholder="5,9"></div>
      <div><label>is_partner_project</label>
        <select name="is_partner_project"><option value="">â€”</option><option>true</option><option>false</option></select>
      </div>
      <div><label>post_handover</label>
        <select name="post_handover"><option value="">â€”</option><option>true</option><option>false</option></select>
      </div>
      <div><label>has_escrow</label>
        <select name="has_escrow"><option value="">â€”</option><option>true</option><option>false</option></select>
      </div>

      <div><label>unit_price_from</label><input type="number" step="any" name="unit_price_from" placeholder="200000"></div>
      <div><label>unit_price_to</label><input type="number" step="any" name="unit_price_to" placeholder="1500000"></div>
      <div><label>price_type</label>
        <select name="price_type"><option value="">â€”</option><option>unit</option><option>area</option></select>
      </div>
      <div><label>unit_area_from</label><input type="number" step="any" name="unit_area_from" placeholder="500"></div>

      <div class="full"><label>completion_date_ranges</label><input type="text" name="completion_date_ranges" placeholder="2025-2026,2027-2028"></div>
      <div><label>preferred_currency</label><input type="text" name="preferred_currency" placeholder="AED"></div>
      <div><label>preferred_area_unit</label><input type="text" name="preferred_area_unit" placeholder="sqft or sqm"></div>

      <div><label>bbox_sw_lat</label><input type="number" step="any" name="bbox_sw_lat"></div>
      <div><label>bbox_sw_lng</label><input type="number" step="any" name="bbox_sw_lng"></div>
      <div><label>bbox_ne_lat</label><input type="number" step="any" name="bbox_ne_lat"></div>
      <div><label>bbox_ne_lng</label><input type="number" step="any" name="bbox_ne_lng"></div>

      <div class="full actions">
        <button type="submit">Ø¨Ø­Ø«</button>
        <button type="button" id="quickFill" class="ghost">ØªØ¬Ø±Ø¨Ø© Ø³Ø±ÙŠØ¹Ø©</button>
        <button type="reset" class="ghost">Ø¥ÙØ±Ø§Øº</button>
        <button type="button" id="regionMapSearch" class="ghost">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙÙ‚Ø·</button>
      </div>
    </form>

    <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div class="results">
      <div class="panel" style="margin:14px 0;">
        <div id="summary" class="muted">â€”</div>
        <div id="debug" class="muted" style="margin-top:6px"></div>
      </div>
      <div id="cards" class="grid"></div>

      <div id="rawPanel" class="panel" style="margin-top:16px; display:none;">
        <h3 style="margin:4px 0 10px">Raw JSON</h3>
        <pre id="jsonOut">â€”</pre>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
  <div class="modal-backdrop" id="mapModal">
    <div class="modal">
      <div class="modal-header">
        <div class="muted" id="mapTitle">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
        <button id="closeMap" class="ghost" style="padding:8px 12px">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div id="map"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    // ====== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ======
    const API_BASE = "https://search-listings-production.up.railway.app/v1/properties";
    const API_KEY  = "reelly-80fd5f24-WLrF9bAxkGwYrUXFjrIyzNxRlzrB4kpH"; // â† Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù…ÙØªØ§Ø­Ùƒ

    const form = document.getElementById("searchForm");
    const cards = document.getElementById("cards");
    const jsonOut = document.getElementById("jsonOut");
    const summary = document.getElementById("summary");
    const debugEl = document.getElementById("debug");
    const rawPanel = document.getElementById("rawPanel");

    // Ø³Ù†Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± Ø¹Ù†Ø§ØµØ± Ø±Ø¬Ø¹Øª Ù…Ù† Ø§Ù„Ø¨Ø­Ø« Ù‡Ù†Ø§:
    let LAST_ITEMS = [];

    // ====== Helpers ======
    function objectFromForm(formEl) {
      const fd = new FormData(formEl);
      const obj = {};
      for (const [k, v] of fd.entries()) if (v.trim() !== "") obj[k] = v.trim();
      return obj;
    }
    function buildParams(dataObj) {
      const params = new URLSearchParams();
      Object.entries(dataObj).forEach(([k,v]) => params.append(k,v));
      return params.toString();
    }
    function safeText(v){ return (v===undefined || v===null) ? "" : String(v); }

    // JSON/ØµÙˆØ±
    function tryParseJSON(str) {
      if (typeof str !== "string") return null;
      const s = str.trim();
      if (!(s.startsWith("{") || s.startsWith("["))) return null;
      try { return JSON.parse(s); } catch { return null; }
    }
    function isImageUrl(u) {
      return typeof u === "string"
        && /^https?:\/\//i.test(u)
        && (/\.(jpg|jpeg|png|webp|gif|bmp|svg)(\?.*)?$/i.test(u) || /image/.test(u));
    }
    function getImageUrl(it){
      if (typeof it.cover_image_url === "string") {
        const parsed = tryParseJSON(it.cover_image_url);
        if (parsed && typeof parsed === "object") {
          if (parsed.url && isImageUrl(parsed.url)) return parsed.url;
          if (parsed.path) return "https://api.reelly.io" + String(parsed.path);
        }
        if (isImageUrl(it.cover_image_url)) return it.cover_image_url;
      }
      const cands = [
        it.image_url, it.image, it.cover_image, it.thumbnail, it.thumb_url,
        it.photo, it.photo_url, it.picture, it.picture_url,
        it.banner, it.banner_url,
        it.images?.[0]?.url, it.images?.[0],
        it.photos?.[0]?.url, it.photos?.[0],
        it.media?.images?.[0]?.url, it.gallery?.[0]?.url,
      ].filter(Boolean);
      for (const u of cands) if (typeof u === "string" && isImageUrl(u)) return u;
      return "https://dummyimage.com/800x500/0d122c/ffffff&text=No+Image";
    }

    // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
    function getCoords(it){
      if (typeof it.coordinates === "string") {
        const parts = it.coordinates.split(",").map(s => Number(s.trim()));
        if (parts.length >= 2 && parts.every(Number.isFinite)) {
          return { lat: parts[0], lng: parts[1] };
        }
      }
      const lat = Number(it.lat ?? it.latitude ?? it.location?.lat ?? it.coordinates?.lat ?? it.coord?.lat ?? it.geo?.lat);
      const lng = Number(it.lng ?? it.lon ?? it.longitude ?? it.location?.lng ?? it.coordinates?.lng ?? it.coord?.lng ?? it.geo?.lng);
      if (Number.isFinite(lat) && Number.isFinite(lng)) return { lat, lng };
      return null;
    }
    function mapLink({lat,lng}){ return `https://www.google.com/maps?q=${lat},${lng}`; }

    // Ø¨Ø·Ø§Ù‚Ø§Øª
    function renderCards(items) {
      cards.innerHTML = "";
      if (!Array.isArray(items) || items.length === 0) {
        cards.innerHTML = "<div class='muted'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</div>";
        return;
      }
      items.forEach(it => {
        const title = safeText(it.title || it.name || it.project_name || it.property_name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…");
        const developer = safeText(it.developer_name || it.developer);
        const area = safeText(it.area || it.unit_area || it.size);
        const bedrooms = safeText(it.bedrooms || it.unit_bedrooms);
        const price = safeText(it.price || it.unit_price || it.min_price || it.starting_price);
        const currency = safeText(it.currency || it.preferred_currency || "");
        const region = safeText(it.region || it.city || it.area_name || it.community);
        const country = safeText(it.country);

        const img = getImageUrl(it);
        const coords = getCoords(it);

        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <img class="thumb" loading="lazy" src="${img}" alt="thumb" />
          <div class="card-body">
            <div class="title">${title}</div>
            <div class="meta" style="margin-bottom:8px">
              ${developer ? `<span class="chip">Ø§Ù„Ù…Ø·ÙˆØ±: ${developer}</span>` : ""}
              ${region ? `<span class="chip">${region}</span>` : ""}
              ${country ? `<span class="chip">${country}</span>` : ""}
              ${bedrooms ? `<span class="chip">ØºØ±Ù: ${bedrooms}</span>` : ""}
              ${area ? `<span class="chip">Ù…Ø³Ø§Ø­Ø©: ${area}</span>` : ""}
              ${price ? `<span class="chip">Ø§Ù„Ø³Ø¹Ø±: ${price} ${currency}</span>` : ""}
            </div>
            <div class="cta">
              <a class="btn" ${coords ? `href="${mapLink(coords)}" target="_blank"` : "disabled"}>${coords ? "ÙØªØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©" : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª"}</a>
            </div>
          </div>
        `;
        cards.appendChild(el);
      });
    }

    // Ø¨Ø­Ø« (GET) + Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ LAST_ITEMS
    async function runSearch(payload) {
      cards.innerHTML = "";
      jsonOut.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
      summary.textContent = "â€”";
      debugEl.textContent = "";

      const qs = buildParams(payload);
      const url = `${API_BASE}?${qs}`;
      try {
        const res = await fetch(url, {
          method: "GET",
          headers: { "X-API-Key": API_KEY, "accept": "application/json" }
        });

        const text = await res.text();
        let data; try { data = JSON.parse(text); } catch { data = { raw: text }; }

        jsonOut.textContent = JSON.stringify(data, null, 2);
        debugEl.textContent = `Status: ${res.status} | URL: ${url}`;

        const items = Array.isArray(data.items) ? data.items
                    : Array.isArray(data.results) ? data.results
                    : Array.isArray(data.data) ? data.data
                    : Array.isArray(data.list) ? data.list
                    : [];

        LAST_ITEMS = items; // â† Ù†Ø®Ø²Ù‘Ù† Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø© Ù‡Ù†Ø§

        const pagination = data.pagination || {};
        const count = items.length;
        const total = (typeof pagination.total === "number") ? pagination.total : "ØŸ";
        const page = pagination.page ?? payload.page ?? 1;
        const pages = pagination.pages ?? "ØŸ";
        const perPage = pagination.per_page ?? payload.per_page ?? "";

        summary.textContent = `Ø¹Ù†Ø§ØµØ±: ${count} | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} | ØµÙØ­Ø©: ${page}/${pages} | Ù„ÙƒÙ„ ØµÙØ­Ø©: ${perPage}`;
        renderCards(items);
      } catch (err) {
        jsonOut.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø¨:\n" + err;
      }
    }

    // ====== Ø®Ø±ÙŠØ·Ø© Ù…Ù† JSON Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø· ======
    let MAP, MARKERS;
    function openMapFromItems(items, title="Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹") {
      const points = items.map(it=>{
        const c = getCoords(it);
        if (!c) return null;
        return {
          ...c,
          title: safeText(it.name || it.title || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"),
          area: safeText(it.area),
          price: safeText(it.min_price ?? it.price),
          currency: safeText(it.price_currency || it.currency || "")
        };
      }).filter(Boolean);

      const mapModal = document.getElementById("mapModal");
      const mapTitle = document.getElementById("mapTitle");
      mapTitle.textContent = `${title} â€” ${points.length} Ø¹Ù†ØµØ±${points.length!==1?"Ù‹Ø§":""}`;
      mapModal.style.display = "flex";

      setTimeout(()=>{
        if (!MAP){
          MAP = L.map('map', { zoomControl: true, attributionControl: false });
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:19 }).addTo(MAP);
          MARKERS = L.layerGroup().addTo(MAP);
        }
        MARKERS.clearLayers();

        if (points.length === 0) {
          MAP.setView([25.2048, 55.2708], 10); // Ø¯Ø¨ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
          return;
        }

        const bounds = [];
        points.forEach(p=>{
          const m = L.marker([p.lat, p.lng]).bindPopup(
            `<b>${p.title}</b><br>${p.area || ""}${(p.area && p.price)?" â€¢ ":""}${p.price? (p.price+" "+p.currency):""}<br>
             <a href="https://www.google.com/maps?q=${p.lat},${p.lng}" target="_blank">ÙØªØ­ ÙÙŠ Google Maps</a>`
          );
          MARKERS.addLayer(m);
          bounds.push([p.lat, p.lng]);
        });
        MAP.fitBounds(bounds, { padding:[30,30] });
      },0);
    }

    // Ø£Ø­Ø¯Ø§Ø«
    document.getElementById("toggleRaw").addEventListener("click", ()=> {
      rawPanel.style.display = rawPanel.style.display === "none" ? "block" : "none";
    });

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const payload = objectFromForm(form);
      runSearch(payload);
    });

    document.getElementById("quickFill").addEventListener("click", () => {
      form.reset();
      form.search_query.value = "Dubai";
      form.per_page.value = "12";
      runSearch({ search_query: "Dubai", per_page: "12" });
    });

    // Ø²Ø±: Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙÙ‚Ø· (Ù…Ù† JSON Ø§Ù„Ø­Ø§Ù„ÙŠ)
  document.getElementById("regionMapSearch").addEventListener("click", ()=>{
  if (!LAST_ITEMS.length) {
    alert("Ø£ÙˆÙ„Ø§Ù‹ Ø§Ø¶ØºØ· (Ø¨Ø­Ø«) Ù„Ù†Ø¬Ù„Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ Ø«Ù… Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø©.");
    return;
  }

  const needle = (document.querySelector('input[name="region"]')?.value || "").trim().toLowerCase();

  // ğŸ” Ù†Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© Ù„Ù„Ù†Ø·Ø§Ù‚: region / city / area_name / area / community / neighborhood
  const filtered = LAST_ITEMS.filter(it=>{
    const haystack = [
      it.region, it.city, it.area_name, it.area, it.community, it.neighborhood
    ].filter(Boolean).join(" ").toLowerCase();

    // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø§ ÙƒØªØ¨ Ø´ÙŠØ¡ØŒ Ù…Ø§ Ù…Ù†ÙÙ„ØªØ±
    return needle ? haystack.includes(needle) : true;
  });

  // ğŸ§­ Ø®Ø° Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡Ø§ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙÙ‚Ø·
  const withCoords = (filtered.length ? filtered : LAST_ITEMS)  // fallback Ø¥Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±Ø© Ø£Ø¹Ø·Øª 0
    .filter(it => !!getCoords(it));

  // Ø¹Ù†ÙˆØ§Ù† Ù…Ù†Ø§Ø³Ø¨ ÙŠÙˆØ¶Ø­ Ù‡Ù„ Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ø§Ù„ÙÙ„ØªØ±Ø© Ø£Ù… fallback
  const title = needle
    ? (filtered.length ? `Ø®Ø±ÙŠØ·Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ ${needle}` : "Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (ÙƒÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©)")
    : "Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ (Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©)";

  openMapFromItems(withCoords, title);

  // Ù…Ù„Ø®Øµ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
  const regionLabel = needle ? ` ÙÙŠ ${needle}` : "";
  summary.textContent = `Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${withCoords.length} Ù…Ø´Ø±ÙˆØ¹Ù‹Ø§ Ù…Ø¹ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª${regionLabel}.`;
});


    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    document.getElementById("closeMap").addEventListener("click", ()=> {
      document.getElementById("mapModal").style.display = "none";
    });
    document.getElementById("mapModal").addEventListener("click", (e)=> {
      if (e.target.id === "mapModal") e.currentTarget.style.display = "none";
    });
  </script>
</body>
</html>
